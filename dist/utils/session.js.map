{"version":3,"file":"session.js","sourceRoot":"/","sources":["utils/session.ts"],"names":[],"mappings":";;;;AACA,6EAA6C;AAC7C,gDAAoD;AACpD,mCAAkC;AAClC,mCAA6B;AAE7B,MAAM,aAAa,GAAG,UAAgB,EAAE,MAAM,EAA8B;;QAC1E,OAAO,MAAM,iBAAO,CAAC,MAAM,CAAC,EAAE,MAAM,EAAE,CAAC,CAAC;IAC1C,CAAC;CAAA,CAAC;AAEF,SAAsB,gBAAgB,CAAC,EAAE,MAAM,EAA8B;;QAC3E,MAAM,OAAO,GAAG,MAAM,aAAa,CAAC,EAAE,MAAM,EAAE,CAAC,CAAC;QAEhD,MAAM,OAAO,GAAG,EAAE,OAAO,EAAE,CAAC,MAAM,OAAO,CAAC,CAAC,GAAG,EAAE,CAAC;QACjD,MAAM,YAAY,GAAG,MAAM,IAAA,eAAO,EAAC,OAAO,EAAE;YAC1C,SAAS,EAAE,IAAI;SAChB,CAAC,CAAC;QAEH,OAAO,YAAY,CAAC;IACtB,CAAC;CAAA;AATD,4CASC;AAED,SAAsB,eAAe,CAAC,IAAS;;QAC7C,MAAM,OAAO,GAAG,IAAA,aAAI,EAAC,IAAI,CAAC,MAAM,EAAE,EAAE,oBAAY,CAAC,CAAC;QAElD,MAAM,WAAW,GAAG,MAAM,IAAA,eAAO,EAAC,OAAO,EAAE;YACzC,SAAS,EAAE,IAAI;SAChB,CAAC,CAAC;QAEH,OAAO,WAAW,CAAC;IACrB,CAAC;CAAA;AARD,0CAQC;AAED,SAAsB,eAAe,CAAC,EAAU;;QAC9C,OAAO,iBAAO,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;IAC9B,CAAC;CAAA;AAFD,0CAEC","sourcesContent":["import { Types } from 'mongoose';\nimport Session from '../models/user/session';\nimport { privateField } from '../models/user/rider';\nimport { signJwt } from './token';\nimport { omit } from 'lodash'\n\nconst createSession = async function ({ userId }: { userId: Types.ObjectId }) {\n  return await Session.create({ userId });\n};\n\nexport async function signRefreshToken({ userId }: { userId: Types.ObjectId }) {\n  const session = await createSession({ userId });\n\n  const payload = { session: (await session)._id };\n  const refreshToken = await signJwt(payload, {\n    expiresIn: '1y'\n  });\n\n  return refreshToken;\n}\n\nexport async function signAccessToken(user: any) {\n  const payload = omit(user.toJSON(), privateField);\n\n  const accessToken = await signJwt(payload, {\n    expiresIn: '1d',\n  });\n\n  return accessToken;\n}\n\nexport async function findSessionById(id: string) {\n  return Session.findById(id);\n}\n"]}